# v0.2.0 Development Plan

## Overview
Version 0.2.0 focuses on improving the sync experience with better token management and continuous sync capabilities.

## Development Workflow

### Branch Strategy
- `main`: Stable releases only
- `develop`: Integration branch for v0.2.0
- `feature/*`: Individual features

### Feature Branches
```bash
git checkout develop
git checkout -b feature/token-refresh
# ... work on feature ...
git push origin feature/token-refresh
# Create PR to develop branch
```

## Priority Features for v0.2.0

### 1. Token Management (Priority: High)
**Branch**: `feature/token-refresh`

- [ ] Implement token refresh using MSAL
- [ ] Add token expiry detection
- [ ] Create refresh command: `dayflow auth refresh`
- [ ] Add token status to `dayflow status` output
- [ ] Store refresh tokens securely (keyring library)

**Files to modify**:
- `dayflow/core/graph_client.py`
- `dayflow/ui/cli.py` (auth commands)
- New: `dayflow/core/token_manager.py`

### 2. Continuous Sync (Priority: High)
**Branch**: `feature/continuous-sync`

- [ ] Create sync daemon using `schedule` library
- [ ] Add `dayflow sync --continuous` command
- [ ] Implement configurable sync intervals
- [ ] Add sync status file tracking
- [ ] Create systemd/launchd service files

**Files to modify**:
- New: `dayflow/core/sync_daemon.py`
- `dayflow/ui/cli.py` (sync commands)
- New: `dayflow/services/` directory

### 3. Incremental Sync (Priority: Medium)
**Branch**: `feature/incremental-sync`

- [ ] Track last sync timestamp
- [ ] Implement delta queries for Graph API
- [ ] Add change detection logic
- [ ] Store sync state in `.dayflow/sync_state.json`

**Files to modify**:
- `dayflow/core/sync.py`
- `dayflow/core/graph_client.py`
- New: `dayflow/core/sync_state.py`

### 4. Progress Indicators (Priority: Medium)
**Branch**: `feature/progress-indicators`

- [ ] Add Rich progress bars
- [ ] Show sync progress (X of Y events)
- [ ] Add --quiet flag for scripts
- [ ] Implement progress callbacks

**Files to modify**:
- `dayflow/core/sync.py`
- `dayflow/ui/cli.py`

### 5. Multiple Calendar Support (Priority: Low)
**Branch**: `feature/multiple-calendars`

- [ ] Add calendar selection to config
- [ ] Support shared calendars
- [ ] Add calendar filtering options
- [ ] Update vault structure for multiple calendars

**Files to modify**:
- `dayflow/vault/config.py`
- `dayflow/core/graph_client.py`
- `dayflow/vault/setup_wizard.py`

## Testing Strategy

### Unit Tests
- Token refresh scenarios
- Daemon lifecycle
- Incremental sync logic
- Progress callback handling

### Integration Tests
- Full sync with token refresh
- Continuous sync for X minutes
- Multiple calendar sync

### Manual Testing
- Windows service installation
- macOS launchd setup
- Linux systemd configuration

## Documentation Updates

- Update user guide with continuous sync
- Add troubleshooting for token issues
- Create service installation guides
- Update API documentation

## Release Criteria

- [ ] All priority features implemented
- [ ] Test coverage maintained >75%
- [ ] Documentation updated
- [ ] Migration guide for existing users
- [ ] Performance benchmarks completed

## Timeline Estimate

- Week 1-2: Token management
- Week 3-4: Continuous sync
- Week 5: Incremental sync
- Week 6: Progress indicators
- Week 7: Testing and documentation
- Week 8: Release preparation

## Next Steps

1. Create feature branch for token refresh
2. Set up MSAL authentication flow
3. Implement basic token refresh mechanism
4. Add tests for token management
